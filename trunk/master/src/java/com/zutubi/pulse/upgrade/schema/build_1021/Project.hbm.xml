<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" >
<hibernate-mapping>

    <!-- A partial mapping to introduce new columns and tables -->
    
    <class name="com.zutubi.pulse.model.Project" table="PROJECT" lazy="false">

        <id name="id" type="java.lang.Long" column="ID" unsaved-value="0">
            <generator class="hilo"/>
        </id>

        <property name="checkoutSchemeName" column="CHECKOUT_SCHEME" type="string" length="50"/>

    </class>

    <class name="com.zutubi.pulse.model.PulseFileDetails" table="BOB_FILE_DETAILS" lazy="false">

        <id name="id" type="java.lang.Long" column="ID" unsaved-value="0">
            <generator class="hilo"/>
        </id>

        <discriminator column="SOURCE_TYPE" type="string" length="63"/>

        <subclass name="com.zutubi.pulse.model.TemplatePulseFileDetails" lazy="false">
            <bag name="captures" cascade="all-delete-orphan" lazy="false">
                <key column="DETAILS_ID"/>
                <one-to-many class="com.zutubi.pulse.model.Capture"/>
            </bag>

            <bag name="outputProcessors" table="OUTPUT_PROCESSORS" lazy="false">
                <key column="DETAILS_ID"/>
                <element type="string" column="PROCESSOR" not-null="true"/>
            </bag>
        </subclass>
    </class>

    <class name="com.zutubi.pulse.model.Capture" table="CAPTURE">
        <id name="id" type="java.lang.Long" column="ID" unsaved-value="0">
            <generator class="hilo"/>
        </id>

        <discriminator column="TYPE" type="string" length="31"/>

        <property name="name" type="string"/>

        <bag name="processors" table="CAPTURE_PROCESSORS" lazy="false">
            <key column="CAPTURE_ID"/>
            <element type="string" column="PROCESSOR" not-null="true"/>
        </bag>

        <subclass name="com.zutubi.pulse.model.DirectoryCapture" discriminator-value="DIRECTORY" lazy="false">
            <property name="base" type="string"/>
            <property name="includes" type="string"/>
            <property name="excludes" type="string"/>
            <property name="mimeType" type="string"/>
        </subclass>

        <subclass name="com.zutubi.pulse.model.FileCapture" discriminator-value="FILE" lazy="false">
            <property name="file" type="string"/>
            <property name="mimeType" type="string"/>
        </subclass>
    </class>

</hibernate-mapping>