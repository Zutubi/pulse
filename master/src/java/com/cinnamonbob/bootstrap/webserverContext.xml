<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<!-- NOTE:
This spring context file contains the configuration for Jetty, the applications webserver.
Initialisation of jetty has been split out from the rest to ensure that the majority of the
system is setup before we start creating the web context. Various components in the web context
manually autowire themselves during init (eg: Hessian), this does not work well when the context
setup is not complete.

Also, as part of three-stage startup, the web app is not deployed until the system startup event
is received, so that users cannot start interacting with the system before it is fully started.
-->
<beans>

    <!-- is the initContext really needed? It appears that singletons are initialised anyways
    without being referenced...-->
    <bean id="initContext" class="com.cinnamonbob.bootstrap.SpringContextInitialisation">
        <property name="initBeans">
            <list>
                <ref bean="jettyManager"/>
            </list>
        </property>
    </bean>

    <bean id="jettyServer" class="com.cinnamonbob.jetty.JettyServerFactoryBean" destroy-method="shutdown">
        <property name="configurationManager">
            <ref bean="configurationManager"/>
        </property>
    </bean>

    <bean id="jettyManager" class="com.cinnamonbob.jetty.JettyManager">
        <property name="jettyServer">
            <ref bean="jettyServer"/>
        </property>
        <property name="eventManager">
            <ref bean="eventManager"/>
        </property>
        <property name="configurationManager">
            <ref bean="configurationManager"/>
        </property>
    </bean>

    <bean id="shutdownManager" class="com.cinnamonbob.ShutdownManager">
        <property name="stoppables">
            <list>
                <ref bean="scheduler"/>
                <!-- We need a way to turn the UI "read only" at this point... -->
                <ref bean="fatController"/>
                <ref bean="masterRecipeProcessor"/>
                <ref bean="jettyManager"/>
            </list>
        </property>
    </bean>

</beans>
