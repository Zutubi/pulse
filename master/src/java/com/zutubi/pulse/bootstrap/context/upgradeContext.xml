<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<!--

-->
<beans>

    <!-- WARNING: as of 05/05/06, the context is empty when this file is being loaded.
        In particular, NO DATASOURCE!. You have been warned.
    -->

    <bean id="upgradeManager" class="com.zutubi.pulse.upgrade.DefaultUpgradeManager" autowire="byName">
        <property name="tasks">
            <list>
                <ref local="scmUidTask"/>
                <ref local="userPropsSchemaUpgrade"/>
                <ref local="userPropsDataUpgrade"/>
                <ref local="encryptPasswordUpgrade"/>
                <ref local="artifactsSchemaUpgrade"/>
                <ref local="mavenCapturesUpgrade"/>
                <ref local="flexibleConditionUpgrade"/>
                <ref local="scmMonitorSchemaUpgrade"/>
                <ref local="scmMonitorDataUpgrade"/>
            </list>
        </property>
    </bean>

    <bean id="scmUidTask" class="com.zutubi.pulse.upgrade.tasks.MigrateSchemaUpgradeTask" autowire="byName">
        <property name="buildNumber" value="1001"/>
        <property name="mappings">
            <list>
                <value>com/zutubi/pulse/upgrade/schema/build_1001/Changelist.hbm.xml</value>
                <value>com/zutubi/pulse/upgrade/schema/build_1001/Revision.hbm.xml</value>
            </list>
        </property>
    </bean>

    <!-- Introduce the new User properties table and migrate the data. -->
    <bean id="userPropsSchemaUpgrade" class="com.zutubi.pulse.upgrade.tasks.UserPropsSchemaUpgradeTask" autowire="byName">
        <property name="buildNumber" value="1011"/>
    </bean>

    <bean id="userPropsDataUpgrade" class="com.zutubi.pulse.upgrade.tasks.UserPropsDataUpgradeTask" autowire="byName">
        <property name="buildNumber" value="1011"/>
    </bean>

    <!-- Encrypt the users passwords in the user table. -->
    <bean id="encryptPasswordUpgrade" class="com.zutubi.pulse.upgrade.tasks.EncodePasswordUpgradeTask" autowire="byName">
        <property name="buildNumber" value="1021"/>
    </bean>

    <bean id="artifactsSchemaUpgrade" class="com.zutubi.pulse.upgrade.tasks.MigrateSchemaUpgradeTask" autowire="byName">
        <property name="buildNumber" value="1021"/>
        <property name="mappings">
            <list>
                <value>com/zutubi/pulse/upgrade/schema/build_1021/Project.hbm.xml</value>
            </list>
        </property>
    </bean>

    <bean id="mavenCapturesUpgrade" class="com.zutubi.pulse.upgrade.tasks.MavenCapturesUpgradeTask" autowire="byName">
        <property name="buildNumber" value="1022"/>
    </bean>

    <bean id="flexibleConditionUpgrade" class="com.zutubi.pulse.upgrade.tasks.FlexibleConditionUpgradeTask" autowire="byName">
        <property name="buildNumber" value="1031"/>
    </bean>

    <bean id="scmMonitorSchemaUpgrade" class="com.zutubi.pulse.upgrade.tasks.ScmMonitorSchemaUpgradeTask" autowire="byName">
        <property name="buildNumber" value="1041"/>
    </bean>

    <bean id="scmMonitorDataUpgrade" class="com.zutubi.pulse.upgrade.tasks.ScmMonitorDataUpgradeTask" autowire="byName">
        <property name="buildNumber" value="1041"/>
    </bean>

</beans>
