<html>
<head>
    <title>#wwtext("name=license.setup")</title>
    <script type="text/javascript" src="$base/js/prototype.js"></script>
    <script type="text/javascript">
    <!--
        function showError(message)
        {
            $("status").innerHTML = "<ul class='error'><li class='error'>" + message + "</li></ul>";
        }

        function handleResponse(response)
        {
            var json = eval("(" + response.responseText + ")");
            if(json.success)
            {
                $("status").innerHTML = "<img src='$base/images/accept.gif'/> $action.getText('license.obtained')";
                $("setupLicense_license").value = json.license;
            }
            else
            {
                showError(json.error);
            }
        }

        function handleError(request)
        {
            showError("$action.getText('license.request.failed')");
        }

        function requestLicense()
        {
            var name = escape($F("name"));
            var email = escape($F("email"));

            $("status").innerHTML = "<img src='$base/images/inprogress.gif'/> $action.getText('license.requesting')";

            var ajax = new Ajax.Request(
                "$base/ajax/requestEvaluation.action",
                {
                    method: 'get',
                    onComplete: handleResponse,
                    onFailure: handleError,
                    onException: handleError,
                    parameters: "name=" + name + "&email=" + email
                }
            );
        }
    -->
    </script>
</head>

<body>
    <h1>:: #wwtext("name=license.setup") ::</h1>

    #parse("/template/includes/actionerrors.vm")

#wwcform("action=setupLicense.action" "heading=%{getText('license.setup')}" "name=setup.license" "method=post")

    #wwtextarea("name=license" "labelCssClass=textarea" "label=%{getText('license.key.field')}" "required=true" "rows=10" "cols=65" "tabindex=1")
    #inlineHelp("license.help")

    #next(2)
#end

    <form id="evaluation">
        <table class="form">
            <tr>
                <th class="heading" colspan="2">
                    #wwtext("name=license.request.evaluation")
                </th>
            </tr>
            <tr>
                <th class="label" ><label for="name" class="label">#wwtext("name=license.full.name")<span class="required">*</span></label>:</th>
                <td class="field"><input type="text" name="name" tabindex="3" id="name"/></td>
            </tr>
            <tr>
                <th class="label" ><label for="email" class="label">#wwtext("name=email")<span class="required">*</span></label>:</th>
                <td class="field"><input type="text" name="email" tabindex="4" id="email"/></td>
            </tr>
            <tr>
                <td class="field" style="text-align: center" colspan="2">
                    <a href="#" onclick="requestLicense(); return false">#wwtext("name=license.request.now")</a>
                    <div style="padding: 5px;" id="status"></div>
                </td>
            </tr>
        </table>
    </form>

</body>
</html>
