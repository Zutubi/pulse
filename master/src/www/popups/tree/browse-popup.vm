<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head>
    <title>file browser</title>

    <link rel="stylesheet" type="text/css" href="/popups/tree/tree.css"/>
    <script type="text/javascript" src="/prototype.js"></script>
    <!--<script type="text/javascript" src="tree/console.js"></script>-->
    <script type="text/javascript" src="tree/tree.js"></script>
    <script type="text/javascript" src="tree/fs.js"></script>
    <script type="text/javascript" src="/main.js"></script>
    <script type="text/javascript">
        <!--
            // define the init properties that control the tree.

            window.onload = onInit;
            window.onresize = onResize;

            function onInit(event)
            {
                // manually resize the viewport so that it is the correct size.
                onResize(event);

                // initialise the tree view.
                var treeView = new ZUTUBI.widget.TreeView("browse");
                treeView.dataLoader = ZUTUBI.fs.list;
                treeView.onSelect = onSelectCallback;
                treeView.draw();

                // trigger a load of the initially required path.
                window.initialPath = ["C:\\", "tmp", "empty"];
                window.retry = 20;
                expandToPath();
            }

            function removeAll(element)
            {
                $A(element.childNodes).each(function(child)
                {
                    Element.remove(child);
                });
            }

            function copySelectedToParentForm()
            {
                var formFieldObject = opener.document.forms['$formname'].elements['$fieldname'];
                var tree = ZUTUBI.widget.View.getTreeById("browse");
                if (tree.selectedNode)
                {
                    formFieldObject.value = tree.selectedNode.getPath();
                }
                return false;
            }

            function deleteSelection()
            {
                try
                {
                    var tree = ZUTUBI.widget.View.getTreeById("browse");
                    if (tree.selectedNode)
                    {
                        ZUTUBI.fs.deleteFile(tree.selectedNode);
                    }
                }
                catch (e)
                {
                    console.log(e);
                }
                return false;
            }

            function openNewFolderPopup()
            {
                window.open('/popups/new-folder.action', 'new_folder', 'width=400, height=120, resizable=yes', false);
                return false
            }
            //-->
    </script>

    <style type="text/css">
        .viewport{
            overflow:auto;
        }

        .bordered{
            margin:0px 0px 10px 0px;
            border-width:1px;
            border-color:blue;
            border-style:solid;
        }

        .nofluff {
           margin:0px;
           padding:0px;
        }

        .toolbarIcon {
            border-width:0px;
        }

    </style>

</head>

<body>

    <div class="bordered" id="toolbar">
        Toolbar:&nbsp;
        <a href="http://www.google.com" onclick="ZUTUBI.widget.View.getTreeById('browse').goUp(); return false;"><img class="toolbarIcon" src="" alt="up"/></a>
        <a href="http://www.google.com" onclick="return openNewFolderPopup(); return false;"><img class="toolbarIcon" src="" alt="new"/></a>
        <a href="http://www.google.com" onclick="return deleteSelection(); return false;"><img class="toolbarIcon" src="" alt="delete"/></a>
        <a href="http://www.google.com" onclick="return false;"><img class="toolbarIcon" src="" alt="refresh"/></a>
        <a href="http://www.google.com" onclick="return false;"><img class="toolbarIcon" src="" alt="pulse home"/></a>
    </div>

    <div class="bordered" id="pathElement">
        Path:&nbsp;<span id="path"></span>
    </div>
    <!--
    is it possible to tie the viewport size to the size
    of the popup window? preferably it would take up the room not used
    by the toolbar top and form at the base of the page.
    -->
    <div class="viewport bordered" id="view">
        <div id="browse" class="tree">
        </div>
    </div>

    <div class="bordered" id="selectForm">
        <form class="nofluff" name="form" action="" onSubmit="window.close();">
            <table>
                <tr>
                    <td nowrap>Selected:</td>
                    <td><input id="selected" type="text" size="40"/></td>
                    <td><input type="submit" value="select" onclick="copySelectedToParentForm();"/></td>
                    <td><input type="submit" value="cancel"/></td>
                </tr>
            </table>
        </form>
    </div>

</body>
</html>
