#helpTag("Projects")
#authorisationTags($principle)
#projectTags($project)
<html>
<head>
    <title>$!webwork.htmlEncode($project.name)</title>
</head>
<body>
    #projectTabs("configuration")

    <table class="columns" width="98%">
        <tr>
            <td class="columns" width="50%">

            <!-- Project basics -->
                <table id="project.basics" class="fill-content">
                    #aclEditHeadingRow("project.basics" 2 "editProject!input.action?id=$project.id" "project.basics.edit" "project")
                    #dynamicRow("project.name" $project.name)
                    <tr>
                        #contentRowHeading("project.description")
                        #wrapCell($project.description)
                    </tr>
                    #dynamicLinkRow("project.url" $project.url $project.url)
                </table>

            <!-- SCM configuration -->
                <table id="project.scm" class="fill-content">
                    #aclEditHeadingRow("project.scm" 2 "editScm!input.action?id=$project.scm.id&amp;projectId=$project.id" "project.scm.edit" "project")
                    #scmRow($project)
                    #dynamicRow("scm.location" $project.scm.createServer().location)
#if($project.scm.class.name == 'com.zutubi.pulse.model.Cvs')
                    #dynamicRow("cvs.branch" $project.scm.branch)
#end
                    #dynamicRow("scm.monitor" "$project.scm.monitor")
                    #if (!$project.scm.pollingInterval)
                        #set($defaultSPI = "$defaultScmPollingInterval (default)")
                        #dynamicRow("scm.polling.interval" $defaultSPI)
                    #else
                        #dynamicRow("scm.polling.interval" "$project.scm.pollingInterval")
                    #end
                    #enabledDisabledRow("scm.filters" $project.scm.filterEnabled)
#acl("domainObject=project" "hasPermission=4,1")
                    <tr>
                        #contentRowHeading("actions")
                        <td class="content">
                            <a href="#" onclick="window.open('$base/popups/viewScmInfo.action?id=$project.id', 'scm info', 'status=yes,resizable=yes,top=100,left=100,width=600,height=400,scrollbars=yes'); return false;">#wwtext("name=scm.info")</a>
                            | <a href="browseProjectScm.action?id=$project.id">#wwtext("name=scm.browse")</a>
                            | <a id="project.scm.filter" href="filterScm.action?id=$project.scm.id&projectId=$project.id">#wwtext("name=scm.filters")</a>
    #authorize("ifAllGranted=ROLE_ADMINISTRATOR")
                            | <a id="commit.message.link.add" href="admin/addCommitMessageLink!input.action?projectId=$project.id">#wwtext("name=commit.message.link.add")</a>
    #end
                        </td>
                    </tr>
#end
                </table>

            <!-- Change Viewer configuration -->
                <table id="project.scm" class="fill-content">
                    #aclEditHeadingRow("project.change.viewer" 2 "changeViewerWizard.action?projectId=$project.id" "project.change.viewer.edit" "project")
#if($project.changeViewer)
                    #dynamicRow("project.change.viewer.details" $project.changeViewer.details)
#else
                    #contentRow("project.change.viewer.none" 2)
#end
                </table>
                
            <!-- Type-specific details -->

                <table id="project.specifics" class="fill-content">
                    #aclEditHeadingRow("project.specifics" 2 "editPulseFileDetails!input.action?id=$project.pulseFileDetails.id&amp;projectId=$project.id" "project.specifics.edit" "project")
                    #dynamicRow("project.type" $project.pulseFileDetails.type)
#foreach($property in $project.pulseFileDetails.properties.entrySet())
                    #propertyRow($property)
#end
#acl("domainObject=project" "hasPermission=4,1")
    #if(!$project.pulseFileDetails.type.equals("versioned"))
                    <tr>
                        #contentRowHeading("actions")
                        <td class="content">
        #if(!$project.pulseFileDetails.type.equals("custom"))
                            <a href="convertToCustomProject!input.action?id=$project.id">
                                #wwtext("name=convert.to.custom")
                            </a>
                            ::
        #end
                            <a href="convertToVersionedProject!input.action?id=$project.id">
                                #wwtext("name=convert.to.versioned")
                            </a>
                        </td>
                    </tr>
    #end
#end
                </table>

            <!-- Artifacts (built in projects only) -->
#if($project.pulseFileDetails.builtIn)
                <table id="project.artifacts" class="fill-content">
                    #headingRow("project.artifacts" 4)
                    <tr>
                        #contentHeading("artifact.name" 1)
                        #contentHeading("artifact.type" 1)
    #acl("domainObject=project" "hasPermission=4,1")
                        #contentHeading("actions" 2)
    #end
                    </tr>
                    <tr>
                        #contentCell("artifact.output")
                        #contentCell("artifact.type.output")
    #acl("domainObject=project" "hasPermission=4,1")
                        #editCell("editOutputProcessors!input.action?projectId=$project.id" "edit_command_output")
                        #contentCell("empty.cell")
    #end
                    </tr>
    #foreach($capture in $project.pulseFileDetails.captures)
        #set($confirmMessage = $action.getText("artifact.confirm.delete", [$capture.name]))
                    <tr>
                        #dynamicCell($capture.name)
                        #dynamicCell($capture.type)
        #acl("domainObject=project" "hasPermission=4,1")
                        #editCell("editArtifact!input.action?projectId=$project.id&amp;id=$capture.id" "edit_$!webwork.htmlEncode($capture.name)")
                        #deleteCell("delete_$!webwork.htmlEncode($capture.name)" "deleteArtifact.action?projectId=$project.id&amp;id=$capture.id" $confirmMessage)
        #end
                     </tr>
    #end
    #acl("domainObject=project" "hasPermission=4,1")
                    #addRow("artifact.add" 5 "addArtifact.action?projectId=$project.id" "project.artifact.add")
    #end
                </table>
#end
            </td>

            <!-- ********** Right hand column ********** -->

            <td class="columns" width="50%">

            <!-- Build specifications -->

                <table id="project.buildspecs" class="fill-content">
                    #headingRow("project.buildspecs" 5)
                    <tr>
                        #contentHeading("buildspec.name" 1)
                        #contentHeading("buildspec.timeout" 1)
#acl("domainObject=project" "hasPermission=4,1")
                        #contentHeading("actions" 3)
#end
                    </tr>
#if($project.buildSpecifications.size() > 0)
    #foreach($buildSpec in $project.buildSpecifications)
        #set($confirmMessage = $action.getText("buildspec.confirm.delete", [$buildSpec.name]))
                    <tr>
                        #dynamicCell($buildSpec.name)
                        #dynamicCell($buildSpec.prettyTimeout)
        #acl("domainObject=project" "hasPermission=4,1")
                        #actionCell("buildspec.trigger" "triggerBuild.action?id=$buildSpec.id&amp;projectId=$project.id" "lightning.gif")
                        #editCell("viewBuildSpecification.action?projectId=$project.id&amp;id=$buildSpec.id" "edit_$!webwork.htmlEncode($buildSpec.name)")
                        #deleteCell("delete_$!webwork.htmlEncode($buildSpec.name)" "deleteBuildSpecification.action?projectId=$project.id&amp;id=$buildSpec.id" $confirmMessage )
        #end
                    </tr>
    #end
#else
                    #contentRow("buildspec.none" 5)
#end
#acl("domainObject=project" "hasPermission=4,1")
                    #addRow("buildspec.add" 5 "createBuildSpecification!input.action?projectId=$project.id" "project.buildspec.add")
#end
                </table>

                <!-- Triggers -->

                <table id="project.triggers" class="fill-content">
                    #headingRow("project.triggers" 7)
                    <tr>
                        #contentHeading("trigger.name" 1)
                        #contentHeading("trigger.type" 1)
                        #contentHeading("trigger.spec" 1)
                        #contentHeading("trigger.state" 1)
#acl("domainObject=project" "hasPermission=4,1")
                        #contentHeading("actions" 3)
#end
                    </tr>
#if($triggers.size() > 0)
    #foreach($trigger in $triggers)
        #set($confirmMessage = $action.getText("trigger.confirm.delete", [$trigger.name]))
                    <tr>
                        #dynamicCell($trigger.name)
                        #dynamicCell($trigger.type)
                        #dynamicCell($trigger.dataMap.spec)
            #if($trigger.paused)
                        #contentCell("trigger.disabled")
            #else
                        #contentCell("trigger.enabled")
            #end

        #acl("domainObject=project" "hasPermission=4,1")
                        <td class="content">
            #if($trigger.paused)
                            <a id="toggle_$!webwork.htmlEncode($trigger.name)" href="toggleTrigger.action?id=$trigger.id&amp;projectId=$project.id&amp;pause=false">#wwtext("name=trigger.enable")</a>
            #else
                            <a id="toggle_$!webwork.htmlEncode($trigger.name)" href="toggleTrigger.action?id=$trigger.id&amp;projectId=$project.id&amp;pause=true">#wwtext("name=trigger.disable")</a>
            #end
                        </td>
                        #editCell("editTrigger!input.action?id=$trigger.id&amp;projectId=$project.id" "edit_$!webwork.htmlEncode($trigger.name)")
                        #deleteCell("delete_$!webwork.htmlEncode($trigger.name)" "deleteTrigger.action?id=$trigger.id" $confirmMessage )
        #end
                    </tr>
    #end
#else
                    #contentRow("triggers.none" 7)
#end
#acl("domainObject=project" "hasPermission=4,1")
                    #addRow("trigger.add" 7 "addTrigger.action?projectId=$project.id" "project.trigger.add")
#end
                </table>

                <!-- Post Build Action -->

                <table id="project.post.build.actions" class="fill-content">
                    #headingRow("project.post.build.actions" 4)
                    <tr>
                        #contentHeading("post.build.action.name" 1)
                        #contentHeading("post.build.action.type" 1)
#acl("domainObject=project" "hasPermission=4,1")
                        #contentHeading("actions" 2)
#end
                    </tr>
#if($project.postBuildActions.size() > 0)
    #foreach($post in $project.postBuildActions)
        #set($confirmMessage = $action.getText("post.build.action.confirm.delete", [$post.name]))
                    <tr>
                        #dynamicCell($post.name)
                        #dynamicCell($post.type)
        #acl("domainObject=project" "hasPermission=4,1")
                        #editCell("editPostBuildAction!input.action?id=$post.id&amp;projectId=$project.id" "edit_$!webwork.htmlEncode($post.name)")
                        #deleteCell("delete_$!webwork.htmlEncode($post.name)" "deletePostBuildAction.action?id=$post.id&amp;projectId=$project.id" $confirmMessage)
        #end
                    </tr>
    #end
#else
                    #contentRow("post.build.actions.none" 4)
#end
#acl("domainObject=project" "hasPermission=4,1")
                    #addRow("post.build.action.add" 4 "addPostBuildAction.action?projectId=$project.id" "project.post.build.action.add")
#end
                </table>

                <!-- Cleanup rules -->

                <table id="project.cleanup" class="fill-content">
                    #headingRow("project.cleanup" 5)
                    <tr>
                        #contentHeading("cleanup.what" 1)
                        #contentHeading("cleanup.states" 1)
                        #contentHeading("cleanup.retain" 1)
#acl("domainObject=project" "hasPermission=4,1")
                        #contentHeading("actions" 2)
#end
                    </tr>
#if($project.cleanupRules.size() > 0)
    #foreach($rule in $project.cleanupRules)
        #set($confirmMessage = $action.getText("cleanup.confirm.delete"))
                    <tr>
        #if($rule.workDirOnly)
                        #contentCell("cleanup.work")
        #else
                        #contentCell("cleanup.result")
        #end
                        #contentCell($rule.prettyStateNames)
                        #contentCell($rule.prettyWhen)
        #acl("domainObject=project" "hasPermission=4,1")
                        #editCell("editCleanupRule!input.action?projectId=$project.id&amp;id=$rule.id" "edit_cleanup_$rule.id")
                        #deleteCell("delete_cleanup_$rule.id" "deleteCleanupRule.action?projectId=$project.id&amp;id=$rule.id" $confirmMessage)
        #end
                    </tr>
    #end
#else
                    #contentRow("cleanup.none" 5)
#end
#acl("domainObject=project" "hasPermission=4,1")
                    #addRow("cleanup.rule.add" 5 "addCleanupRule!input.action?projectId=$project.id" "project.cleanup.add")
#end
                </table>

            </td>
        </tr>
    </table>

    #tabEnd()
</body>
</html>
