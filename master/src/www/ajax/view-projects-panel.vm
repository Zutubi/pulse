##
## Shows a list of recent builds for the given list of projects
##
#macro(recentBuilds $group $projects)
    #set($fullSpan = $columns.totalSpan + 6)
#if($group)
    #set($groupId = $group.name)
#else
    #set($groupId = "_ungrouped")
#end

    <table class="content" id='#id("group.$groupId")'>
        <tr>
            <th class="group" colspan="$fullSpan">
#if($group)
    #if($rssEnabled)
                <span class="action">
                    <a class="unadorned" id="rss.builds.#id($group.name)" href="rss.action?groupName=#uce($group.name)"><img alt="$action.getText('rss')" src="$base/images/feed-icon-16x16.gif"/></a>
                </span>
    #end
                #html($group.name)
#else
                #wwtext("name=projects")
#end
            </th>
        </tr>
        <tr>
            <th class="heading" colspan="6">#wwtext("name=project")</th>
            <th class="heading" colspan="$columns.totalSpan">
                #wwtext("name=latest.build")
            </th>
        </tr>
        <tr>
            #contentHeading("project.name" 1)
            #contentHeading("project.actions" 5)
            #buildTableHeaders($columns false)
        </tr>
    #foreach($project in $projects)
        #set($lastResult = false)
        #set($lastResult = $action.getLatestBuild($project))
        #set($health = $action.getHealth($project))
            <tr id='#id("group.${groupId}.project.${project.name}")'>
                <td class="content">
                    <img alt="health: $health" src="$base/images/health/${health}.gif"/>
                    <a href="$urls.projectHome($project)" id="#uce($project.name)">$!webwork.htmlEncode($project.name)</a>
                </td>
                #actionCellTitle("home-#uce($project.name)" "home.tab" "$urls.projectHome($project)" "house.gif")
                #actionCellTitle("reports-#uce($project.name)" "reporting.tab" "$urls.projectReports($project)" "chart_bar.gif")
                #actionCellTitle("history-#uce($project.name)" "history.tab" "$urls.projectHistory($project)" "time.gif")
                #actionCellTitle("config-#uce($project.name)" "configuration.tab" "$base/admin/projects/#uce($project.name)/" "pencil.gif")
            #if($action.hasPermission("trigger", $project))
                #actionCellTitle("trigger-#uce($project.name)" "project.trigger" "/triggerBuild.action?projectName=#uce($project.name)" "lightning.gif")
            #else
                <td class="content">&nbsp;</td>
            #end
        #if($lastResult)
                #buildTableCells($lastResult $columns true)
        #else
                <td class="content" colspan="$columns.totalSpan">#wwtext("name=never.built")
        #end
            </tr>
    #end
        </table>
#end

#if($totalProjectCount > 0)
    #foreach($group in $groups)
        #recentBuilds($group $group.projects)
    #end
    #if($projects.size() > 0)
        #recentBuilds(false $projects)
    #end
#else
    <p>
        No projects found.
    #auth("path=projects" "action=create")
        You can add new projects at the <a href="$urls.adminProjects()">projects tab</a> in the administration section.
    #end
    </p>
#end

#buildTableColumns($columns "all.projects")