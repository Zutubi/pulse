<!-- page properties are specified using <content tag="selectedTab">navigate</content> -->
#if($page.getProperty("page.projectId"))
    #set ($projectId = $page.getProperty("page.projectId"))
#end
#if($page.getProperty("page.projectName"))
    #set ($projectName = $page.getProperty("page.projectName"))
#end
#if($page.getProperty("page.personalBuild"))
    #set ($personalBuild = true)
#end
#if($page.getProperty("page.buildId"))
    #set ($buildId = $page.getProperty("page.buildId"))
#end
#if($page.getProperty("page.buildNumber"))
    #set ($buildNumber = $page.getProperty("page.buildNumber"))
#end
#if($page.getProperty("page.resultNodeId"))
    #set ($resultNodeId = $page.getProperty("page.resultNodeId"))
#end
#if($page.getProperty("page.stageName"))
    #set ($stageName = $page.getProperty("page.stageName"))
#end
#if($page.getProperty("page.agentId"))
    #set ($agentId = $page.getProperty("page.agentId"))
#end
#if($page.getProperty("page.agentName"))
    #set ($agentName = $page.getProperty("page.agentName"))
#end
#if($page.getProperty("page.resourceId"))
    #set ($resourceId = $page.getProperty("page.resourceId"))
#end
#if($page.getProperty("page.resourceName"))
    #set ($resourceName = $page.getProperty("page.resourceName"))
#end
#if($page.getProperty("page.user.name"))
    #set ($userName = $page.getProperty("page.user.name"))
#end
#if($page.getProperty("page.user.login"))
    #set ($userLogin = $page.getProperty("page.user.login"))
#end
#if($page.getProperty("page.helpPage"))
    #set ($helpPage = $page.getProperty("page.helpPage"))
#end

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  	<head>
        <meta http-equiv="Pragma" content="no-cache"/>
        <meta http-equiv="Expires" content="0"/>
        <meta http-equiv="Cache-Control" content="no-cache"/>
		<title>:: pulse :: #if ($title) $title #end</title>
        <link rel="shortcut icon" href="$base/favicon.ico"/>
        <link rel="icon" type="image/png" href="$base/favicon.png"/>
        <link rel="stylesheet" type="text/css" href="/css/ext-all.css"/>
        <link rel="stylesheet" type="text/css" href="$base/css/main.css" media="screen"/>
		<link rel="stylesheet" type="text/css" href="$base/css/form.css" media="screen"/>
#if ($rssEnabled && $projectId && $projectId != "0")
        <link rel="alternate" type="application/rss+xml" title="RSS" href="$base/rss.action?projectId=$projectId"/>
#end
        <script type="text/javascript" src="/js/ext-base.js"></script>
        <script type="text/javascript" src="/js/ext-all.js"></script>
        <script type="text/javascript" src="$base/js/main.js"></script>
        <script type="text/javascript" src="$base/js/zutubi.js"></script>
        <script type="text/javascript">
            Ext.BLANK_IMAGE_URL = '$base/images/default/s.gif';
            
            var layout;
            var nestedLayout;

            var PageLayout = function() {
                return {
                    init: function() {
                        // If there is a tab bar, drop it in to the north div.
                        var tabbar = Ext.get('tabbar');
                        if(tabbar)
                        {
                            var north = Ext.get('north');
                            north.appendChild(tabbar);
                        }

                        layout = new Ext.BorderLayout(document.body, {
                            hideOnLayout: true,
                            north: {
                                split: false,
                                titlebar: false
                            },
                            south: {
                                split: false,
                                titlebar: false,
                                collapsible: false,
                                animate: true
                            },
                            center: {
                               autoScroll: false
                            }
                        });

                        nestedLayout = new Ext.BorderLayout('content', {
                            hideOnLayout: true,
                            center: {
                                autoScroll: true
                            }
                        });

                        nestedLayout.beginUpdate();
                        nestedLayout.add('center', new Ext.ContentPanel('center', {title: 'Close Me', closable: false}));
                        nestedLayout.endUpdate();

                        layout.beginUpdate();
                        layout.add('north', new Ext.ContentPanel('north', 'North'));
                        layout.add('south', new Ext.ContentPanel('south', 'South'));
                        layout.add('center', new Ext.NestedLayoutPanel(nestedLayout));
                        layout.endUpdate();
                    }
                }
            }();

            Ext.onReady(PageLayout.init, PageLayout, true);
        </script>

		$head
	</head>

      <body
#if($page.getProperty("page.onLoad"))
          onload="$page.getProperty('page.onLoad')"
#end
      >
      <div id="north">
      <div id="header">
        <table>
            <tr>
              <td class="logo">
                  :: <a href="$base/default.action">pulse 2 [ M3 ]</a> ::
#if($u_projectName)
                  <a href="$urls.projectHome($u_projectName)">$h_projectName</a>
#end
#if($personalBuild)
                 <a href="$base/myBuilds.action">my builds</a>
#end
#if($buildNumber && $buildNumber != "0")
                  :: <a href="$urls.build($u_projectName, $buildNumber)">build $buildNumber</a>
    #if($u_stageName)
                  :: <a href="$urls.stageDetails($u_projectName, $buildNumber, $u_stageName)">stage $h_stageName</a>
    #end
#end
#if($u_agentName)
                  <a href="$urls.agentStatus($u_agentName)">$h_agentName</a>
#end
              </td>
              <td class="user" align="right">
#if($principle)
                  $principle.name [ <a id="prefs" href="$base/dashboard/preferences/">preferences</a>#if($canLogout) | <a id="logout" href="$base/logout.action">logout</a>#end ]
#else
                  <a id="login" href="$base/login.action">login</a>
#end
                  &nbsp;
#if($helpPage)

#else
    #set($helpPage = "Home")
#end
                  <a class="unadorned" href="$helpUrl/$helpPage">
                      <img alt="help" src="$base/images/help.gif"/>
                  </a>
              </td>
            </tr>
        </table>
      </div>

#if($page.getProperty("page.selectedTab"))
    #set ($selectedTab = $page.getProperty("page.selectedTab"))
#end
      <ul id="nav">
#if($principle)
        <li><a #if($selectedTab && $selectedTab == "dashboard")      class="active" #end id="tab.dashboard" href="$base/dashboard/home/">dashboard</a></li>
#end
        <li><a #if($selectedTab && $selectedTab == "projects")       class="active" #end id="tab.projects" href="$base/browse/">browse</a></li>
        <li><a #if($selectedTab && $selectedTab == "queues")         class="active" #end id="tab.queues" href="$base/viewServerQueues.action">queues</a></li>
        <li><a #if($selectedTab && $selectedTab == "agents")         class="active" #end id="tab.agents" href="$base/agents/">agents</a></li>
        #authorize("ifAllGranted=ROLE_ADMINISTRATOR")
        <li><a #if($selectedTab && $selectedTab == "administration") class="active" #end id="tab.administration" href="$base/admin/projects/">administration</a></li>
        #end
      </ul>
      <div class="clear"></div>
      </div>

      <div id="content" class="ylayout-inactive-content"></div>

      <div id="center">
          $body
          #if($license.expired)
            <div id="statusmessage">#wwtext("name=license.expiry.notice")</div>
          #end
      </div>
        
      <div id="south">
         <b>::</b> <a href="http://zutubi.com/products/pulse/">pulse</a> ($version_number #$build_number)
         <span style="font-weight: bold; color: red">:: EXPERIMENTAL :: (You have been warned!)</span>
         <b>::</b> copyright &copy; 2005-2007 <a href="http://zutubi.com/">zutubi pty ltd</a> <b>::</b>
         <a href="http://jira.zutubi.com/">report bug/request feature</a>
      </div>
        
    </body>
</html>
