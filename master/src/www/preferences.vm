#helpTag("User+Preferences")
#authorisationTags($principle)
<content tag="selectedTab">dashboard</content>
<html>
<head>
    <title>#wwtext("name=dashboard")</title>
</head>
<body>
    #dashboardTabs("preferences")

    #parse("/template/includes/actionerrors.vm")

    <table class="columns" width="90%">
        <tr>
            <td class="columns" width="40%">
                <table id="user" class="fill-content">
                    #editHeadingRow("user" 2 "$base/user/editUser!input.action?userId=$user.id" "user.edit")
                    #dynamicRow("user.login" $user.login)
                    #dynamicRow("user.name" $user.name)
                </table>
                <table id="aliases" class="fill-content">
                    #headingRow("aliases" 2)
                    <tr>
                        #contentHeading("alias" 1)
                        #contentHeading("actions" 1)
                    </tr>
#foreach($alias in $user.aliases)
    #set($confirmMessage = $action.getText("alias.delete.confirm", [$!webwork.htmlEncode($alias)]))
                    <tr>
                        #dynamicCell($alias)
                        #deleteCell("deleteAlias$velocityCount" "$base/user/deleteAlias.action?userId=$user.id&index=$velocityCount" $confirmMessage)
                    </tr>
#end
                    #addRow("alias.add" 2 "$base/user/addAlias!input.action?userId=$user.id" "alias.add")
                </table>
                <table id="settings" class="fill-content">
                    #editHeadingRow("settings" 2 "user/editUserSettings!input.action?userId=$user.id" "user.settings")
                    #dynamicRow("user.default.page" $user.defaultAction)
                    #dynamicRow("user.refresh.live.content" $refreshInterval)
                    #dynamicRow("user.recipe.tail.lines" $user.tailLines)
                    #dynamicRow("user.refresh.recipe.tail" $tailRefreshInterval)
                </table>
            </td>
            <td class="columns" width="40%">
                <table id="contacts" class="fill-content">
                    #headingRow("contacts" 4)
                    <tr>
                        #contentHeading("contact.name" 1)
                        #contentHeading("contact.uid" 1)
                        #contentHeading("actions" 2)
                    </tr>

#foreach ($contact in $user.contactPoints)
                    <tr>
    #set($confirmMessage = $action.getText("contact.delete.confirm", [$contact.name]))
                        <td class="content" #if($contact.lastError) rowspan="2" #end>
                            $!webwork.htmlEncode($contact.name)
                        </td>
                        #dynamicCell($contact.uid)
                        #editCell("$base/user/editContactPoint!default.action?id=$contact.id&userId=$user.id" "edit_$!webwork.htmlEncode($contact.name)")
                        #deleteCell("delete_$!webwork.htmlEncode($contact.name)" "$base/user/deleteContactPoint.action?id=$contact.id&userId=$user.id" $confirmMessage)
                    </tr>
    #if($contact.lastError)
                    <tr>
                        <td class="note" colspan="3">
                            #wwtext("name=contact.error") $!webwork.htmlEncode($contact.lastError)
                            (<a href="$base/user/clearContactPointError.action?id=$contact.id">#wwtext("name=contact.error.clear")</a>)
                        </td>
                    </tr>
    #end
#end
                    #addRow("contact.create" 4 "$base/user/contactWizard.action?userId=$user.id" "contact.create")
                </table>
                <table id="subscriptions" class="fill-content">
                    #headingRow("subscriptions" 4)
                    <tr>
                        #contentHeading("subscription.contact" 1)
                        #contentHeading("subscription.to" 1)
                        #contentHeading("actions" 2)
                    </tr>

#foreach ($subscription in $user.subscriptions)
    #set($contact = $subscription.contactPoint)
    #set($projects = $subscription.projects)
    #set($confirmMessage = $action.getText("subscription.delete.confirm", [$project.name]))
                    <tr>
                        #dynamicCell($contact.name)
                        <td class="content">
    #if($subscription.personal)
                            #wwtext("name=subscription.personal")
    #else
        #if($projects.size() > 0)
            #foreach($project in $projects)
                            $!webwork.htmlEncode($project.name)<br/>
            #end
        #else
                            #wwtext("name=subscription.projects.all")
        #end
    #end
                        </td>
    #if($subscription.personal)
                        #editCell("$base/user/editPersonalBuildSubscription!input.action?id=$subscription.id" "edit_sub_$subscription.id")
    #else
                        #editCell("$base/user/editProjectBuildSubscription!input.action?id=$subscription.id" "edit_sub_$subscription.id")
    #end
                        #deleteCell("delete_$subscription.id" "$base/user/deleteSubscription.action?id=$subscription.id&login=$user.login" $confirmMessage)
                    </tr>
#end
                <!--
                 can only create subscriptions is the system has configured projects accessible to
                 the user AND the user has configured contact points.
                -->
#if($user.contactPoints.size() > 0)
    #if($projectCount > 0)
                    #addRow("subscription.create" 4 "$base/user/subscriptionWizard.action?userId=$user.id" "subscription.create")
    #else
                    <td class="content" colspan="4">#wwtext("name=subscription.requires.project")</td>    
    #end
#else
                    <td class="content" colspan="4">#wwtext("name=subscription.requires.contact")</td>
#end
                </table>
            </td>
        </tr>
    </table>

    #tabEnd()
</body>
</html>
