#macro(detailrow $header $content)
    <tr><th class="command-detail">$header</th><td class="command-detail">$content</td></tr>
#end

<html>
    <head>
        <link href="build.css" rel="stylesheet" type="text/css">
        <title>[CiB] $project.name</title>
        <content tag="action">project.view</content>
    </head>
    <body>
        <h1 class="build-log">:: $project.name ::</h1>
        
        <h2 class="command-info">basic details (<a href="editProject!default.action?id=$project.id">edit</a>)</h2>
        <div class="command-content">
            <table>
                #detailrow("name" $project.name)
                #detailrow("description" $project.description)
                #detailrow("bob file" $project.bobFile)
            </table>
        </div>
        
        <h2 class="command-info">scm details (<a href="createScm!default.action?project=$project.id">add</a>)</h2>
        <div class="command-content">
            #set($scms = $project.scms)
            #if ($scms.size() == 0)
                No SCMs configured
            #else
                <ul>
                #foreach ($scm in $scms)
                    <li>#scmIcon($scm) $scm.name (<a href="editScm!default.action?id=$scm.id&project=$project.id">edit</a>|<a href="deleteScm.action?id=$project.id&name=$scm.name">delete</a>)</li>
                #end
                </ul>
            #end
        </div>

        <h2 class="command-info">schedules</h2>
        <div class="command-content">
            <table>
                <tr>
                    <th class="command-detail">name</th>
                    <th class="command-detail">recipe</th>
                    <th colspan="2" class="command-detail">actions</th>
                </tr>
            #foreach ($schedule in $schedules)
                #if($schedule.recipe)
                    #set($recipe = $schedule.task.recipe)
                #else
                    #set($recipe = "[default]")
                #end
                <tr>
                    <td class="command-detail">$schedule.name</td>
                    <td class="command-detail">$recipe</td>
                    <td class="command-detail"><a href="deleteSchedule.action?id=$schedule.id">delete</a></td>
                </tr>
            #end
                <tr>
                    <td colspan="4" class="command-detail"><b>+</b> <a href="createSchedule!default.action?project=$project.id">add new schedule</a></td>
                </tr>
            </table>
        </div>
<!--
        <div>
            <p>Subscription: <a href="createSubscription!default.action?project=$project.name">create</a></p>
        </div>
-->
        #if($currentRecipe)
            #if($currentRecipe.inProgress())
                #set($class = "info")
            #elseif($currentRecipe.succeeded())
                #set($class = "success")
            #else
              #set($class = "failure")
            #end
            <h2 class="command-$class">current build [<a href="viewBuild.action?id=$project.id&buildId=$currentRecipe.id">$currentRecipe.number</a>] (<a href="scheduleBuild.action?id=$id">build</a>)</h2>
            <div class="command-content">
            <table>          
                #detailrow("commenced" $currentRecipe.stamps.prettyStartTime)
                #detailrow("elapsed"   $currentRecipe.stamps.prettyElapsed)
                #detailrow("status"    $currentRecipe.state.prettyString)
            </table>
            #if($currentRecipe.errorMessage)
                <h2 class="command-element">error details</h2>    
                <div class="error">
                <b>message</b>
                <pre>$currentRecipe.errorMessage</pre>
                </div>
            #end  
            #if($currentRecipe.commandResults.size() > 0)
                <h2 class="command-element">command log</h2>
                <table>
                   <tr>
                        <th class="command-detail">command</th>
                        <th class="command-detail">when</th>
                        <th class="command-detail">elapsed</th>
                        <th class="command-detail">status</th>
                    </tr>
                    #foreach($result in $currentRecipe.commandResults)
                        #if($result.commenced())
                            #if($result.succeeded())
                                #set($class = "success")
                            #elseif($result.inProgress())
                                #set($class = "info")
                            #else
                                #set($class = "failure")
                            #end
                            <tr>
                                <td class="build-$class">$result.commandName</td>
                                <td class="build-$class">$result.stamps.prettyStartTime</td>
                                <td class="build-$class">$result.stamps.prettyElapsed</td>
                                <td class="build-$class">$result.state.prettyString</td>
                            </tr>
                        #end
                    #end
                </table>
            #end
        </div>
      #end

        <h2 class="command-info">history (<a href="scheduleBuild.action?id=$id">build</a>)</h2>
        <div class="command-content">
        <table>
            <tr>
                <th class="command-detail">build id</th>
                <th class="command-detail">when</th>
                <th class="command-detail">elapsed</th>
                <th class="command-detail">result</th>
            </tr>
            #foreach($result in $history)
                #set($id = $result.id)
                #set($built = $result.stamps.prettyStartTime) 
                #set($elapsed = $result.stamps.prettyElapsed)
                #if($result.inProgress())
                    #set($class = "info")
                #elseif($result.succeeded())
                    #set($class = "success")
                #else
                    #set($class = "failure")
                #end
            <tr>
                <td class="build-$class"><a href="viewBuild.action?id=$project.id&buildId=$id">build $result.number</a></td>
                <td class="build-$class">$built</td>
                <td class="build-$class">$elapsed</td>
                <td class="build-$class">$result.state.prettyString</td>
            </tr>
            #end
        </table>
        </div>
    </body>
</html>