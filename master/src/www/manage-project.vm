#macro(detailrow $header $content)
    <tr><th class="command-detail">$header</th><td class="command-detail">$content</td></tr>
#end

<html>
    <head>
        <link href="build.css" rel="stylesheet" type="text/css">
        <title>$project.name</title>
        <content tag="action">project.view</content>
    </head>
    <body>
        <h1 class="build-log">:: $project.name ::</h1>

        <div id="project-left-column">

        <h2 class="command-info">basic details</h2>
        <div class="command-content">
            <table>
                #detailrow("name" $project.name)
                #detailrow("description" $project.description)
                #detailrow("bob file" $project.bobFile)
                #detailrow("action" "<a href='editProject!default.action?id=$project.id'>edit</a>")
            </table>
        </div>
        
        <h2 class="command-info">scm details</h2>
        <div class="command-content">
            #set($scms = $project.scms)
            <table>
                <tr>
                    <th class="command-detail">name</th>
                    <th colspan="2" class="command-detail">actions</th>
                </tr>
            #foreach ($scm in $scms)
                <tr>
                    <td class="command-detail">#scmIcon($scm)<a href="">$scm.name</a></td>
                    <td class="command-detail"><a href="editScm!default.action?id=$scm.id&project=$project.id">edit</a></td>
                    <td class="command-detail"><a href="deleteScm.action?id=$project.id&name=$scm.name">delete</a></td>
                </tr>
            #end
                <tr>
                    <td colspan="3" class="command-detail"><b>+</b> <a href="createScm!default.action?project=$project.id">add new scm</a></td>
                </tr>
            </table>
        </div>

        <h2 class="command-info">build specifications</h2>
        <div class="command-content">
            <table>
                <tr>
                    <th class="command-detail">name</th>
                    <th colspan="2" class="command-detail">actions</th>
                </tr>
            #foreach ($buildSpec in $project.buildSpecifications)
                <tr>
                    <td class="command-detail"><a href="viewBuildSpecification.action?projectId=$project.id&id=$buildSpec.id">$buildSpec.name</a></td>
                    <td class="command-detail"><a href="triggerBuild.action?id=$buildSpec.id&projectId=$project.id">trigger</a></td>
                    <td class="command-detail"><a href="deleteBuildSpecification.action?id=$buildSpec.id">delete</a></td>
                </tr>
            #end
                <tr>
                    <td colspan="3" class="command-detail"><b>+</b> <a href="createBuildSpecification!default.action?projectId=$project.id">add new build specification</a></td>
                </tr>
            </table>
        </div>


        <h2 class="command-info">triggers</h2>
        <div class="command-content">
            <table>
                <tr>
                    <th class="command-detail">name</th>
                    <th class="command-detail">recipe</th>
                    <th colspan="2" class="command-detail">actions</th>
                </tr>
            #foreach ($trigger in $triggers)
                    #set($recipe = "[default]")
                <tr>
                    <td class="command-detail">$trigger.name</td>
                    <td class="command-detail">$recipe</td>
                    <td class="command-detail"><a href="deleteTrigger.action?id=$trigger.id">delete</a></td>
                </tr>
            #end
                <tr>
                    <td colspan="4" class="command-detail"><b>+</b> <a href="createTrigger!default.action?project=$project.id">add new trigger</a></td>
                </tr>
            </table>
        </div>

        </div>

        <div id="project-content">

        #if($currentBuild)
            #set($recipeResult = $currentBuild.results.get(0).result)
            #if($recipeResult.inProgress())
                #set($class = "info")
            #elseif($recipeResult.succeeded())
                #set($class = "success")
            #else
              #set($class = "failure")
            #end
            <h2 class="command-$class">current build [<a href="viewBuild.action?id=$project.id&buildId=$currentBuild.id">$currentBuild.number</a>]</h2>
            <div class="command-content">
            <table>          
                #detailrow("commenced" $recipeResult.stamps.prettyStartTime)
                #detailrow("elapsed"   $recipeResult.stamps.prettyElapsed)
                #detailrow("status"    $recipeResult.state.prettyString)
            </table>
            #if($recipeResult.errorMessage)
                <h2 class="command-element">error details</h2>    
                <div class="error">
                <b>message</b>
                <pre>$recipeResult.errorMessage</pre>
                </div>
            #end
            #if($recipeResult.commandResults.size() > 0)
                <h2 class="command-element">command log</h2>
                <table>
                   <tr>
                        <th class="command-detail">command</th>
                        <th class="command-detail">when</th>
                        <th class="command-detail">elapsed</th>
                        <th class="command-detail">status</th>
                    </tr>
                    #foreach($result in $recipeResult.commandResults)
                        #if($result.commenced())
                            #if($result.succeeded())
                                #set($class = "success")
                            #elseif($result.inProgress())
                                #set($class = "info")
                            #else
                                #set($class = "failure")
                            #end
                            <tr>
                                <td class="build-$class">$result.commandName</td>
                                <td class="build-$class">$result.stamps.prettyStartTime</td>
                                <td class="build-$class">$result.stamps.prettyElapsed</td>
                                <td class="build-$class">$result.state.prettyString</td>
                            </tr>
                        #end
                    #end
                </table>
            #end
        </div>
      #end

        <h2 class="command-info">history</h2>
        <div class="command-content">
        <table>
            <tr>
                <th class="command-detail">build id</th>
                <th class="command-detail">when</th>
                <th class="command-detail">elapsed</th>
                <th class="command-detail">result</th>
            </tr>
            #foreach($buildResult in $history)
                #set($result = $buildResult.results.get(0).result)
                #set($id = $buildResult.id)
                #set($built = $result.stamps.prettyStartTime) 
                #set($elapsed = $result.stamps.prettyElapsed)
                #if($result.inProgress())
                    #set($class = "info")
                #elseif($result.succeeded())
                    #set($class = "success")
                #else
                    #set($class = "failure")
                #end
            <tr>
                <td class="build-$class"><a href="viewBuild.action?id=$project.id&buildId=$id">build $buildResult.number</a></td>
                <td class="build-$class">$built</td>
                <td class="build-$class">$elapsed</td>
                <td class="build-$class">$result.state.prettyString</td>
            </tr>
            #end
        </table>
        </div>

        </div>
    </body>
</html>