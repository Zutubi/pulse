#helpTag("LDAP+Configuration")
#authorisationTags($principle)
<content tag="selectedTab">administration</content>
<html>
<head>
    <title>#wwtext("name=ldap.config")</title>

    <script type="text/javascript" src="/prototype.js"></script>

    <script type="text/javascript">
        #ajaxError("test-results")

        function testSettings()
        {
            #testInProgress("test-results")

            var host = escape($F("ldap.config_ldap_host"));
            var baseDn = escape($F("ldap.config_ldap_baseDn"));
            var managerDn = escape($F("ldap.config_ldap_managerDn"));
            var managerPassword = escape($F("ldap.config_ldap_managerPassword"));
            var params = "host=" + host + "&baseDn=" + baseDn + "&managerDn=" + managerDn + "&managerPassword=" + managerPassword;

            var updater = new Ajax.Updater({success: 'test-results'},
                                           "/ajax/testLdap.action",
                                           {
                                               method: 'get',
                                               parameters: params,
                                               onFailure: reportError
                                           });

        }
    </script>
</head>
<body>
    #adminTabs("settings")

    #parse("/template/includes/actionerrors.vm")

#wwcform("action=saveLdap!save.action" "heading=%{getText('ldap.config')}" "id=ldap.config" "method=post")

    #wwcheckbox("name=ldap.enabled" "label=%{getText('ldap.enabled')}" "tabindex=1" "onclick=setFormEnableState('ldap.config', 'ldap.config_ldap_enabled', false)")
    #wwtextfield("name=ldap.host" "label=%{getText('ldap.host.url')}" "required=true" "size=60" "tabindex=2")
    #inlineHelp("ldap.host.url.help")
    #wwtextfield("name=ldap.baseDn" "label=%{getText('ldap.base.dn')}" "required=true" "size=60" "tabindex=3")
    #inlineHelp("ldap.base.dn.help")
    #wwtextfield("name=ldap.managerDn" "label=%{getText('ldap.manager.dn')}" "size=60" "tabindex=4")
    #inlineHelp("ldap.manager.dn.help")
    #wwpassword("name=ldap.managerPassword" "label=%{getText('ldap.manager.password')}" "showPassword=true" "tabindex=5")
    #inlineHelp("ldap.manager.password.help")
    #wwtextfield("name=ldap.userFilter" "label=%{getText('ldap.user.filter')}" "size=60" "required=true" "tabindex=6")
    #inlineHelp("ldap.user.filter.help")
    #wwcheckbox("name=ldap.autoAdd" "label=%{getText('ldap.auto.add')}" "tabindex=7")
    #inlineHelp("ldap.auto.add.help")

    #testSettingsRow()

    #saveCancel(8)
#end

    <script type="text/javascript">
        setFormEnableState('ldap.config', 'ldap.config_ldap_enabled', false);
    </script>
    #tabEnd()
</body>
</html>
