#authorisationTags($principle)
#buildTags($buildResult.project $buildResult)
<html>
<head>
    <title>$!webwork.htmlEncode($path)</title>

#if ($buildResult.getHasWorkDir())
    <link rel="stylesheet" type="text/css" href="$base/css/treeview/tree.css"/>
    <script type="text/javascript" src="$base/js/prototype.js"></script>
    <script type="text/javascript" src="$base/js/zutubi.js"></script>
    <script type="text/javascript" src="$base/js/yahoo/yahoo.js"></script>
    <script type="text/javascript" src="$base/js/yahoo/event.js"></script>
    <script type="text/javascript" src="$base/js/yahoo/treeview.js"></script>
    <script type="text/javascript" src="$base/js/widget/treeview.js"></script>
    <script type="text/javascript" src="$base/js/main.js"></script>
    <script type="text/javascript">

        window.onload = initialize;

        function initialize()
        {
            // only initialise if the browseTree element exists. If the browse tree element does not
            // exist, then we do not want to render the node.
            if (!document.getElementById('browseTree'))
            {
                return;
            }

            var tree = new ZUTUBI.widget.PulseTreeView('browseTree');
            tree.setSeparator('$separator');
            tree.setFSRoot('pulse:///projects/$project.id/builds/$buildResult.id/wc/');
            tree.setBase('$base');

            // load the root nodes for the file system, then draw the tree.
            Element.show($('loading'));
            tree.ls(tree.getRoot(), function()
            {
                Element.hide($('loading'));
                tree.draw();
            }, true, false);
        }

    </script>
#end
</head>
<body>
    #buildTabs($buildResult "working-dir")

<h3>#wwtext("name=working.copy")</h3>

#if ($buildResult.getHasWorkDir())
        <p>
            The tree below allows you to navigate through the working directory for this build.  Click on the <img src="$base/images/arrow_down.gif"/> to download it.
        </p>

        #if($buildResult.completed())
            <div id="loading" style="display:none;"><img src="$base/images/treeview/loading.gif" alt="loading..."/></div>
            <div id="error"></div>
            <div id="wcTree">
                <div id="browseTree"></div>
            </div>
        #else
            <p>
                #wwtext("name=working.dir.pending")
            </p>
        #end
#else
    <p style="max-width:600px">
        The working directory for this build is not available.
        #if ($buildSpecification.getRetainWorkingCopy())
            This is likely the result of one of the following:
            <ul>
                <li><strong>1</strong>&nbsp;&nbsp; The build specification was not configured to retain the working copy at the time of the build.</li>
                <li><strong>2</strong>&nbsp;&nbsp; The project's <a href="$base/configureProject.action?id=$project.id">cleanup rules</a> have removed this working copy.</li>
                <li><strong>3</strong>&nbsp;&nbsp; It has been manually deleted from the filesystem.</li>
            </ul>
        #else
            This is because the working directory is not being retained after a build.  If you would like to retain
            the working copy, you will need to <a href="$base/viewBuildSpecification.action?projectId=$project.id&id=$buildSpecification.id">update the build specification</a> and tick the retain working copy option.
        #end
    </p>
#end

    #tabEnd()
</body>
</html>
