<?xml version="1.0" encoding="UTF-8"?>
<project name="Test plugins" basedir="." default="build">

    <target name="init">
        <property name="project.root.dir" value="."/>
    </target>

    <target name="clean">
        <delete dir="plugins"/>
        <foreach target="clean"/>
    </target>
    
    <target name="build" depends="init, clean">
        <foreach target="build.plugin"/>
        
        <copy file="pluginA/build/pluginA.jar" todir="plugins"/>
        <copy file="pluginB/build/pluginB.jar" todir="plugins"/>
        <copy file="pluginC/build/pluginC.zip" todir="plugins"/>
        <copy file="pluginX/build/pluginX.zip" todir="plugins"/>
        <copy file="pluginY/build/pluginY.zip" todir="plugins"/>

        <!-- expand pluginB into a directory for testing expanded plugins -->
        <mkdir dir="plugins/pluginD"/>
        <unzip src="pluginD/build/pluginD.zip" dest="plugins/pluginD"/>

    </target>
    
    <!--
     Execute the specified target on each of the modules.
    -->
    <macrodef name="foreach">
        <attribute name="target"/>
        <sequential>
            <ant inheritAll="false" dir="pluginA" antfile="build.xml" target="@{target}"/>
            <ant inheritAll="false" dir="pluginB" antfile="build.xml" target="@{target}"/>
            <ant inheritAll="false" dir="pluginC" antfile="build.xml" target="@{target}"/>
            <ant inheritAll="false" dir="pluginD" antfile="build.xml" target="@{target}"/>
            <ant inheritAll="false" dir="pluginX" antfile="build.xml" target="@{target}"/>
            <ant inheritAll="false" dir="pluginY" antfile="build.xml" target="@{target}"/>
        </sequential>
    </macrodef>
    
</project>