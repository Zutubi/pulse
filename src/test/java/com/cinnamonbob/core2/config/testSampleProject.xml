<?xml version="1.0"?>
<project name="sampleProject" defaultRecipe="default">

    <description>Self-hosting magic</description>

    <property name="home.dir" value="/home/daniel"/>
    <property name="home.dir" value="E:/tmp/bob-build"/>
    <property name="ant.bin" value="E:/opt/ant/apache-ant-1.6.2/bin/ant"/>

    <post-processor name="generic.pp">
        <regex>
            <pattern category="error" expression=".*[Ee]rror.*"/>
            <pattern category="warning" expression=".*[Ww]arning.*"/>
        </regex>
    </post-processor>
    <post-processor name="ant.pp">
        <regex>
            <pattern category="info" expression=".*BUILD.*"/>
        </regex>
    </post-processor>
    <post-processor name="svn.pp">
        <regex>
            <pattern category="info" expression=".*Checked out revision.*"/>
        </regex>
    </post-processor>
    <post-processor name="junit.pp">
        <regex>
            <pattern category="info" expression="Tests run.*"/>
        </regex>
    </post-processor>


    <schedule recipe="fullBuild">
        <!-- Run a nightly build. -->
        <cron schedule="0 0 12 ? * *"/>
    </schedule>

    <recipe name="default">
        <command name="sync">
            <executable exe="svn" args="checkout svn+ssh://daniel@www.cinnamonbob.com/usr/local/svn-repo/bob"
                        working-dir="${work.dir}"/>
            <process artifact="output" processor="svn.pp"/>
            <process artifact="output" processor="generic.pp"/>
        </command>
        <command name="build">
            <executable exe="${ant.bin}" args="build" working-dir="${work.dir}/bob/trunk"/>
            <process artifact="output" processor="ant.pp"/>
            <process artifact="output" processor="generic.pp"/>
        </command>
        <command name="test">
            <executable exe="${ant.bin}" args="test" working-dir="${work.dir}/bob/trunk">
                <environment name="CLASSPATH" value="E:/opt/java/jdk1.5.0/bin/java"/>
            </executable>
            <artifact name="junit" title="Test Report" type="text/plain"
                      from-file="${work.dir}/bob/trunk/build/test/report/TEST-com.cinnamonbob.core2.XMLConfigUtilsTest.txt"/>
            <process artifact="output" processor="ant.pp"/>
            <process artifact="output" processor="generic.pp"/>
            <process artifact="junit" processor="junit.pp"/>
        </command>
    </recipe>

    <recipe name="scm">
        <command name="svn">
            <svn-checkout user="jason" password="jason"
                          url="svn+ssh://jason@www.anyhews.net/usr/local/svn-repo/bob/trunk"
                          path="${work.dir}"/>
        </command>
    </recipe>
</project>
