<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
    <link href="${base}/css/reset.css" rel="stylesheet"/>

    <link href="${base}/css/kendo/kendo.common-material.min.css" rel="stylesheet"/>
    <link href="${base}/css/kendo/kendo.material.min.css" rel="stylesheet"/>
    <link href="${base}/css/admina.css" rel="stylesheet"/>

    <script>
        window.baseUrl = '${base}';
        adminPath = '/${path}/';
    </script>

    #javascript()
        zutubi/admin/package.js
    #end

    <title>Pulse Admin</title>
</head>
<body>
<div id="navbar">
    Nav
</div>

<div id="content">
    <div id="notification"></div>
    <div id="config-view" style="height: 100%; width: 100%">

    </div>
</div>

<div id="footer">
    footer bar
</div>

<script>
    var notificationElement = $("#notification");
    notificationElement.kendoNotification({
        autoHideAfter: 7000,
        allowHideAfter: 1000,
        button: true,
        hideOnClick: false,
        position: {
            top: 50
        },
        stacking: 'down'
    });

    var notificationWidget = notificationElement.data("kendoNotification");

    function zaReportSuccess(message)
    {
        notificationWidget.success(message);
    }

    function zaReportError(message)
    {
        notificationWidget.error(message);
    }

    function zaAjaxError(jqXHR)
    {
        var message = '';
        if (jqXHR.statusText)
        {
            message = jqXHR.statusText + ' ';
        }

        message += '(' + jqXHR.status + ')';

        try
        {
            details = JSON.parse(jqXHR.responseText);
            if (details.message)
            {
                message += ': ' + details.message;
            }
        }
        catch(e)
        {
            // Do nothing.
        }

        return message;
    }

    var router = new kendo.Router({
        root: window.baseUrl + '/admina',
        pushState: true,
        routeMissing: function(e)
        {
            notificationWidget.error('Unknown admin path "' + e.url + '", redirecting.')
            router.navigate("/projects/");
        }
    });

    function showScope(scope)
    {
        if (window.configPanel)
        {
            window.configPanel.destroy();
            window.configPanel = null;
        }
    }

    function subpath(path, begin, end)
    {
        var elements = path.split('/');

        if (typeof end === "undefined")
        {
            end = elements.length;
        }

        elements = elements.slice(begin, end);
        return elements.join('/');
    }

    function showConfig(path)
    {
        if (!window.configPanel)
        {
            window.configPanel = new Zutubi.admin.ConfigPanel("#config-view");
            window.configPanel.bind('pathselect', function (e) {
                router.navigate(e.path, true);
            });
        }

        window.configPanel.setPath(path);
    }

    router.route("/", function(path) {
        router.navigate("/projects/");
    });

    router.route("/projects/*path", function(path)
    {
        if (path)
        {
            showConfig('projects/' + path);
        }
        else
        {
            showScope('projects');
        }
    });

    router.route("/agents/*path", function(path)
    {
        console.dir(path);
    });

    router.route("/settings/*path", function(path)
    {
        showConfig('settings/' + (path ? path : ''));
    });

    router.route("/users/*path", function(path)
    {
        console.dir(path);
    });

    router.route("/groups/*path", function(path)
    {
        console.dir(path);
    });

    router.route("/plugins(/:id)", function(id)
    {
        console.dir(id);
    });

    $(document).ready(function()
    {
        router.start();
    });
</script>
</body>
</html>
