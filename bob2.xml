<?xml version="1.0"?>
<project default-recipe="default">
    <junit.pp name="junit.pp"/>

    <macro name="ant-build">
        <command name="build">
            <ant name="build" targets="${targets}"/>
            <dir-artifact name="combined junit" base="build/reports/junit/html" fail-if-not-present="false"/>
            <dir-artifact name="core junit" base="core/build/reports/junit/html" fail-if-not-present="false"/>
            <dir-artifact name="server-core junit" base="server-core/build/reports/junit/html" fail-if-not-present="false"/>
            <dir-artifact name="master junit" base="master/build/reports/junit/html" fail-if-not-present="false"/>
            <dir-artifact name="local junit" base="local/build/reports/junit/html" fail-if-not-present="false"/>
            <dir-artifact name="junit xml reports">
                <include pattern="**/build/reports/junit/xml/*.xml"/>
                <process processor="${junit.pp}"/>
            </dir-artifact>
        </command>
    </macro>

    <recipe name="default">
        <property name="targets" value="build.all"/>
        <macro-ref macro="${ant-build}"/>
    </recipe>

    <recipe name="acceptance">
        <property name="targets" value="accept.master"/>
        <macro-ref macro="${ant-build}"/>
    </recipe>

    <recipe name="dbtest">
        <ant name="package" args="-Dskip.tests=true" targets="package.master"/>
        <command name="build">
            <ant targets="accept.master.nodeps"/>
            <dir-artifact name="junit" base="build/reports/junit/html" fail-if-not-present="false"/>
            <dir-artifact name="junit xml reports">
                <include pattern="**/build/reports/junit/xml/*.xml"/>
                <process processor="${junit.pp}"/>
            </dir-artifact>
        </command>
    </recipe>
</project>
